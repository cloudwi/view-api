---
openapi: 3.0.1
info:
  title: View API
  version: v1
  description: 의견 투표 서비스 API
paths:
  "/auth/me":
    get:
      summary: 현재 로그인한 사용자 정보 조회
      tags:
      - Auth
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 사용자 정보 반환
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  email:
                    type: string
                  nickname:
                    type: string
                required:
                - id
                - nickname
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
  "/views/{view_id}/comments":
    parameters:
    - name: view_id
      in: path
      description: 뷰 ID
      required: true
      schema:
        type: integer
    get:
      summary: 댓글 목록 조회
      tags:
      - Comments
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 댓글 목록 반환
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      "$ref": "#/components/schemas/Comment"
                required:
                - data
        '404':
          description: 뷰를 찾을 수 없음
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
    post:
      summary: 댓글 작성
      tags:
      - Comments
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '201':
          description: 댓글 작성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    "$ref": "#/components/schemas/Comment"
                required:
                - data
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '404':
          description: 뷰를 찾을 수 없음
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '422':
          description: 유효성 검사 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ValidationErrors"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: object
                  properties:
                    content:
                      type: string
                      description: 댓글 내용 (최소 1자, 최대 2000자)
                  required:
                  - content
              required:
              - comment
  "/views/{view_id}/comments/{id}":
    parameters:
    - name: view_id
      in: path
      description: 뷰 ID
      required: true
      schema:
        type: integer
    - name: id
      in: path
      description: 댓글 ID
      required: true
      schema:
        type: integer
    patch:
      summary: 댓글 수정
      tags:
      - Comments
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '200':
          description: 댓글 수정 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    "$ref": "#/components/schemas/Comment"
                required:
                - data
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '403':
          description: 권한 없음 (본인의 댓글만 수정 가능)
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '404':
          description: 댓글을 찾을 수 없음
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '422':
          description: 유효성 검사 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ValidationErrors"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: object
                  properties:
                    content:
                      type: string
                      description: 댓글 내용 (최소 1자, 최대 2000자)
                  required:
                  - content
              required:
              - comment
    delete:
      summary: 댓글 삭제
      tags:
      - Comments
      security:
      - bearer_auth: []
      responses:
        '204':
          description: 삭제 성공
        '401':
          description: 인증 실패
        '403':
          description: 권한 없음 (본인의 댓글만 삭제 가능)
        '404':
          description: 댓글을 찾을 수 없음
  "/views":
    get:
      summary: 뷰(의견) 목록 조회
      tags:
      - Views
      security:
      - bearer_auth: []
      parameters:
      - name: q
        in: query
        required: false
        description: 제목 검색어
        schema:
          type: string
      - name: author
        in: query
        required: false
        enum:
        - me
        description: "작성자 필터 (me: 내가 작성한 뷰만 조회, 인증 필요):\n * `me` \n "
        schema:
          type: string
      - name: sort
        in: query
        required: false
        enum:
        - latest
        - most_votes
        - hot
        description: '정렬 기준 (latest: 최신순, most_votes: 투표 많은 순, hot: 인기순 - 투표수+댓글수+시간가중)'
        schema:
          type: string
      - name: per_page
        in: query
        required: false
        description: '페이지당 항목 수 (기본값: 20, 최대: 100)'
        schema:
          type: integer
      - name: cursor
        in: query
        required: false
        description: 다음 페이지를 위한 커서
        schema:
          type: string
      responses:
        '200':
          description: 뷰 목록 반환
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ViewListResponse"
    post:
      summary: 새 뷰(의견) 생성
      tags:
      - Views
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '201':
          description: 뷰 생성 성공
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ViewListItem"
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '422':
          description: 유효성 검사 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ValidationErrors"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                view:
                  type: object
                  properties:
                    title:
                      type: string
                      description: 뷰 제목
                    view_options_attributes:
                      type: array
                      description: 선택지 목록 (최소 2개)
                      items:
                        type: object
                        properties:
                          content:
                            type: string
                            description: 선택지 내용
                        required:
                        - content
                  required:
                  - title
                  - view_options_attributes
              required:
              - view
  "/views/{id}":
    parameters:
    - name: id
      in: path
      description: 뷰 ID
      required: true
      schema:
        type: integer
    get:
      summary: 뷰(의견) 상세 조회
      tags:
      - Views
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 뷰 상세 정보 반환 (댓글 포함)
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ViewDetail"
        '404':
          description: 뷰를 찾을 수 없음
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
    patch:
      summary: 뷰(의견) 수정
      tags:
      - Views
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '200':
          description: 뷰 수정 성공
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ViewListItem"
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '403':
          description: 권한 없음 (본인의 뷰만 수정 가능)
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '404':
          description: 뷰를 찾을 수 없음
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                view:
                  type: object
                  properties:
                    title:
                      type: string
                      description: 뷰 제목
                    view_options_attributes:
                      type: array
                      description: 선택지 목록
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                            description: 기존 선택지 ID (수정 시)
                          content:
                            type: string
                            description: 선택지 내용
                          _destroy:
                            type: boolean
                            description: 선택지 삭제 여부
              required:
              - view
    delete:
      summary: 뷰(의견) 삭제
      tags:
      - Views
      security:
      - bearer_auth: []
      responses:
        '204':
          description: 삭제 성공
        '401':
          description: 인증 실패
        '403':
          description: 권한 없음 (본인의 뷰만 삭제 가능)
        '404':
          description: 뷰를 찾을 수 없음
  "/views/{view_id}/vote":
    parameters:
    - name: view_id
      in: path
      description: 뷰 ID
      required: true
      schema:
        type: integer
    post:
      summary: 투표하기
      tags:
      - Votes
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '201':
          description: 투표 성공
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/VoteResult"
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '404':
          description: 뷰 또는 선택지를 찾을 수 없음
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '422':
          description: 유효성 검사 실패 (이미 투표함)
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ValidationErrors"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                view_option_id:
                  type: integer
                  description: 투표할 선택지 ID
              required:
              - view_option_id
    delete:
      summary: 투표 취소
      tags:
      - Votes
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 투표 취소 성공
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/VoteResult"
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        '404':
          description: 뷰 또는 투표를 찾을 수 없음
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
servers:
- url: http://localhost:3000
  description: Development server
- url: https://api.example.com
  description: Production server
components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
        nickname:
          type: string
      required:
      - id
      - nickname
    Author:
      type: object
      properties:
        id:
          type: integer
        nickname:
          type: string
      required:
      - id
      - nickname
    ViewOption:
      type: object
      properties:
        id:
          type: integer
        content:
          type: string
        votes_count:
          type: integer
      required:
      - id
      - content
      - votes_count
    MyVote:
      type: object
      nullable: true
      properties:
        option_id:
          type: integer
    Comment:
      type: object
      properties:
        id:
          type: integer
        content:
          type: string
        author:
          "$ref": "#/components/schemas/Author"
        created_at:
          type: string
          format: date-time
      required:
      - id
      - content
      - author
      - created_at
    ViewListItem:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        author:
          "$ref": "#/components/schemas/Author"
        options:
          type: array
          items:
            "$ref": "#/components/schemas/ViewOption"
        total_votes:
          type: integer
        my_vote:
          "$ref": "#/components/schemas/MyVote"
        comments_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        edited:
          type: boolean
      required:
      - id
      - title
      - author
      - options
      - total_votes
      - created_at
      - updated_at
      - edited
    ViewDetail:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        author:
          "$ref": "#/components/schemas/Author"
        options:
          type: array
          items:
            "$ref": "#/components/schemas/ViewOption"
        total_votes:
          type: integer
        my_vote:
          "$ref": "#/components/schemas/MyVote"
        comments:
          type: array
          items:
            "$ref": "#/components/schemas/Comment"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        edited:
          type: boolean
      required:
      - id
      - title
      - author
      - options
      - total_votes
      - comments
      - created_at
      - updated_at
      - edited
    ViewInput:
      type: object
      properties:
        view:
          type: object
          properties:
            title:
              type: string
            view_options_attributes:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                  content:
                    type: string
                  _destroy:
                    type: boolean
                required:
                - content
          required:
          - title
          - view_options_attributes
      required:
      - view
    VoteInput:
      type: object
      properties:
        view_option_id:
          type: integer
      required:
      - view_option_id
    VoteResult:
      type: object
      properties:
        view_id:
          type: integer
        options:
          type: array
          items:
            "$ref": "#/components/schemas/ViewOption"
        total_votes:
          type: integer
        my_vote:
          "$ref": "#/components/schemas/MyVote"
      required:
      - view_id
      - options
      - total_votes
    Error:
      type: object
      properties:
        error:
          type: string
    ValidationErrors:
      type: object
      properties:
        errors:
          type: array
          items:
            type: string
    PaginationMeta:
      type: object
      properties:
        per_page:
          type: integer
        has_next:
          type: boolean
        next_cursor:
          type: string
          nullable: true
      required:
      - per_page
      - has_next
    ViewListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            "$ref": "#/components/schemas/ViewListItem"
        meta:
          "$ref": "#/components/schemas/PaginationMeta"
      required:
      - data
      - meta
